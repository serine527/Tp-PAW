<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tutorial 2 — Attendance System (JS + jQuery)</title>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--accent:#2563eb;--card-bg:#fff}
    body{font-family:Inter, system-ui, Arial;background:#f3f6fb;margin:0;padding:20px;color:#0f172a}
    h1{font-size:1.4rem;margin-bottom:12px}
    .container{max-width:1200px;margin:auto}
    .card{background:var(--card-bg);padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06);margin-bottom:16px}
    table{width:100%;border-collapse:collapse;font-size:0.92rem}
    th,td{border:1px solid #e6e9ef;padding:6px;text-align:center}
    thead th{background:#fbfcfe;font-weight:700}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .btn.secondary{background:#6b7280}
    .error{color:#b91c1c;font-size:0.82rem;margin-top:4px}
    .success{color:green}
    .report{display:flex;gap:20px;align-items:flex-start}
    .report-summaries{min-width:240px}
    .highlight-hover{outline:2px solid rgba(99,102,241,0.12);background:#fbfbff}
    .status-good{background:linear-gradient(90deg,rgba(34,197,94,0.08),rgba(34,197,94,0.02))}
    .status-warning{background:linear-gradient(90deg,rgba(250,204,21,0.08),rgba(250,204,21,0.02))}
    .status-bad{background:linear-gradient(90deg,rgba(239,68,68,0.06),rgba(239,68,68,0.02))}
    .small{font-size:0.85rem}

    /* PULSE ANIMATION */
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(37,99,235,0.12); transform: translateY(0px); }
      50% { box-shadow: 0 0 18px 6px rgba(37,99,235,0.12); transform: translateY(-2px); }
      100% { box-shadow: 0 0 0 0 rgba(37,99,235,0.00); transform: translateY(0px); }
    }
    .pulse {
      animation: pulse 1200ms infinite ease-in-out;
      border-radius: 6px;
      background: linear-gradient(90deg, rgba(37,99,235,0.06), rgba(37,99,235,0.02));
    }
    #attendance-table tbody tr.pulse td {
      position: relative;
      z-index: 1;
    }

    /* Search input */
    #search-box {
      width: 260px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      margin-bottom: 12px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Advanced Web Programming — Tutorial 2 (Attendance System)</h1>

    <div class="card">

      <!--  NEW SEARCH INPUT -->
      <label><strong>Search by Name:</strong></label><br>
      <input type="text" id="search-box" placeholder="Type a name...">

      <div class="controls">
        <button class="btn" id="show-report">Show Report</button>
        <button class="btn" id="highlight-excellent">Highlight Excellent Students</button>
        <button class="btn secondary" id="reset-colors">Reset Colors</button>
        <button class="btn" id="sort-abs">Sort by Absences (Ascending)</button>
        <button class="btn" id="sort-part">Sort by Participation (Descending)</button>
      </div>

      <div style="overflow:auto">
        <table id="attendance-table">
          <thead>
            <tr>
              <th rowspan="2">Last Name</th>
              <th rowspan="2">First Name</th>
              <th colspan="2">S1</th>
              <th colspan="2">S2</th>
              <th colspan="2">S3</th>
              <th colspan="2">S4</th>
              <th colspan="2">S5</th>
              <th colspan="2">S6</th>
              <th rowspan="2">Absences</th>
              <th rowspan="2">Participation</th>
              <th rowspan="2">Message</th>
            </tr>
            <tr>
              <th>P</th><th>Pa</th>
              <th>P</th><th>Pa</th>
              <th>P</th><th>Pa</th>
              <th>P</th><th>Pa</th>
              <th>P</th><th>Pa</th>
              <th>P</th><th>Pa</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="ln">Ahmed</td>
              <td class="fn">Sara</td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td><input type="checkbox" class="s"></td><td><input type="checkbox" class="pa"></td>
              <td class="absences small">0 Abs</td>
              <td class="participations small">0 Par</td>
              <td class="message small">-</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p id="sort-status" style="font-weight:bold; margin-top:10px;"></p>

    </div>

    <div class="card">
      <h2>Add Student</h2>
      <form id="add-student" novalidate>
        <label>Student ID</label>
        <input type="text" id="sid" name="sid"><div class="error" id="err-sid"></div>
        <label>Last Name</label>
        <input type="text" id="lname" name="lname"><div class="error" id="err-lname"></div>
        <label>First Name</label>
        <input type="text" id="fname" name="fname"><div class="error" id="err-fname"></div>
        <label>Email</label>
        <input type="email" id="email" name="email"><div class="error" id="err-email"></div>
        <br><button class="btn" type="submit">Submit</button><span id="form-success" class="success"></span>
      </form>
    </div>

    <div class="card" id="report-card" style="display:none">
      <h2>Report</h2>
      <div class="report">
        <div class="report-summaries">
          <p>Total students: <strong id="report-total">0</strong></p>
          <p>Students with at least one present mark: <strong id="report-present">0</strong></p>
          <p>Students with at least one participation: <strong id="report-participated">0</strong></p>
          <p>Students absent only: <strong id="report-absent">0</strong></p>
        </div>
        <div style="flex:1">
          <canvas id="report-chart" style="max-width:600px"></canvas>
        </div>
      </div>
    </div>
  </div>

<script>
  function evaluateRow($tr){
    const presence = $tr.find('input.s');
    const participation = $tr.find('input.pa');

    let presentCount = 0;
    presence.each(function(){ if(this.checked) presentCount++; });

    const absences = presence.length - presentCount;

    let partCount = 0;
    participation.each(function(){ if(this.checked) partCount++; });

    $tr.find('.absences').text(absences + ' Abs');
    $tr.find('.participations').text(partCount + ' Par');

    $tr.removeClass('status-good status-warning status-bad');
    if(absences < 3) $tr.addClass('status-good');
    else if(absences <= 4) $tr.addClass('status-warning');
    else $tr.addClass('status-bad');

    let message = "";
    if(absences >= 5){
      message = "Excluded – too many absences – You need to participate more";
    }
    else if(absences >= 3){
      if(partCount === 0)
        message = "Warning – attendance low – You need to participate more";
      else
        message = "Warning – attendance low";
    }
    else {
      if(partCount >= 3)
        message = "Good attendance – Excellent participation";
      else if(partCount >= 1)
        message = "Good attendance – Moderate participation";
      else
        message = "Good attendance – You need to participate more";
    }

    $tr.find('.message').text(message);
  }

  function evaluateAll(){
    $('#attendance-table tbody tr').each(function(){ evaluateRow($(this)); });
  }

  let chartInstance = null;
  function showReport(){
    const $rows = $('#attendance-table tbody tr');
    const total = $rows.length;
    let totalPresence = 0, totalParticipation = 0, totalAbsences = 0;

    $rows.each(function(){
      const pres = $(this).find('input.s:checked').length;
      const part = $(this).find('input.pa:checked').length;
      totalPresence += pres;
      totalParticipation += part;
      totalAbsences += (6 - pres);
    });

    $('#report-total').text(total);
    $('#report-present').text(totalPresence);
    $('#report-participated').text(totalParticipation);

    const data = {
      labels: ['Presence', 'Participation', 'Absences'],
      datasets: [{
        label: 'Attendance Overview',
        data: [totalPresence, totalParticipation, totalAbsences],
        backgroundColor: ['#2563eb', '#10b981', '#ef4444']
      }]
    };

    if(chartInstance) chartInstance.destroy();
    const ctx = document.getElementById('report-chart').getContext('2d');
    chartInstance = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
      }
    });

    $('#report-card').show();
  }

  function validateForm(){
    let valid = true;

    const sid = $('#sid').val().trim();
    const lname = $('#lname').val().trim();
    const fname = $('#fname').val().trim();
    const email = $('#email').val().trim();

    $('.error').text('');

    if(sid === ''){
      $('#err-sid').text('Student ID is required.');
      valid = false;
    } else if(!/^[0-9]+$/.test(sid)){
      $('#err-sid').text('Student ID must contain only numbers.');
      valid = false;
    }

    if(lname === ''){
      $('#err-lname').text('Last Name is required.');
      valid = false;
    } else if(!/^[A-Za-z]+$/.test(lname)){
      $('#err-lname').text('Last Name must contain only letters.');
      valid = false;
    }

    if(fname === ''){
      $('#err-fname').text('First Name is required.');
      valid = false;
    } else if(!/^[A-Za-z]+$/.test(fname)){
      $('#err-fname').text('First Name must contain only letters.');
      valid = false;
    }

    if(email === ''){
      $('#err-email').text('Email is required.');
      valid = false;
    } else if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
      $('#err-email').text('Enter a valid email (e.g. name@example.com).');
      valid = false;
    }

    return valid;
  }

  function createRowObj(lname, fname){
    const row = `
      <tr>
        <td class="ln">${lname}</td>
        <td class="fn">${fname}</td>
        ${Array(6).fill().map(()=>`
          <td><input type="checkbox" class="s"></td>
          <td><input type="checkbox" class="pa"></td>
        `).join('')}
        <td class="absences small">0 Abs</td>
        <td class="participations small">0 Par</td>
        <td class="message small">-</td>
      </tr>
    `;
    return $(row);
  }

  $(document).ready(function(){
    evaluateAll();

    $('#attendance-table').on('change','input.s, input.pa',function(){
      evaluateRow($(this).closest('tr'));
      if($('#report-card').is(':visible')) showReport();
    });

    $('#attendance-table').on('mouseenter','tbody tr',function(){
      $(this).addClass('highlight-hover');
    }).on('mouseleave','tbody tr',function(){
      $(this).removeClass('highlight-hover');
    });

    $('#attendance-table').on('click','tbody tr',function(e){
      if($(e.target).is('input')) return;
      const lname = $(this).find('.ln').text();
      const fname = $(this).find('.fn').text();
      const abs = $(this).find('.absences').text();
      alert('Student: ' + fname + ' ' + lname + '\n' + abs);
    });

    $('#add-student').on('submit',function(e){
      e.preventDefault();
      $('#form-success').text('');
      if(!validateForm()) return;

      const lname = $('#lname').val().trim();
      const fname = $('#fname').val().trim();
      const $new = createRowObj(lname, fname);
      $('#attendance-table tbody').append($new);
      evaluateRow($new);

      $('#form-success').text('✅ Student successfully added!');
      $('#sid,#lname,#fname,#email').val('');
      setTimeout(()=>$('#form-success').fadeOut(300).text('').show(),3000);

      if($('#report-card').is(':visible')) showReport();
    });

    $('#show-report').on('click',function(){ showReport(); });

    $('#highlight-excellent').on('click',function(){
      $('#attendance-table tbody tr').each(function(){
        const abs = parseInt($(this).find('.absences').text()) || 0;
        if(abs < 3){
          $(this).addClass('pulse');
        }
      });
    });

    $('#reset-colors').on('click',function(){
      $('#attendance-table tbody tr').removeClass('pulse status-good status-warning status-bad highlight-hover');
      evaluateAll();
    });

    /* SEARCH BY NAME */
    $('#search-box').on('keyup', function() {
      const query = $(this).val().toLowerCase();

      $('#attendance-table tbody tr').filter(function() {
        const lname = $(this).find('.ln').text().toLowerCase();
        const fname = $(this).find('.fn').text().toLowerCase();
        const full = lname + " " + fname;

        $(this).toggle(
          lname.includes(query) ||
          fname.includes(query) ||
          full.includes(query)
        );
      });
    });
    /* ==========================
     SORTING FUNCTIONALITY
   ========================== */

// Sort by Absences (Ascending)
$('#sort-abs').on('click', function () {
  let rows = $('#attendance-table tbody tr').get();

  rows.sort(function(a, b) {
    let absA = parseInt($(a).find('.absences').text()) || 0;
    let absB = parseInt($(b).find('.absences').text()) || 0;
    return absA - absB;
  });

  $('#attendance-table tbody').append(rows);
  $('#sort-status').text("Currently sorted by absences (ascending)");
});

// Sort by Participation (Descending)
$('#sort-part').on('click', function () {
  let rows = $('#attendance-table tbody tr').get();

  rows.sort(function(a, b) {
    let partA = parseInt($(a).find('.participations').text()) || 0;
    let partB = parseInt($(b).find('.participations').text()) || 0;
    return partB - partA;
  });

  $('#attendance-table tbody').append(rows);
  $('#sort-status').text("Currently sorted by participation (descending)");
});
 

  });
</script>

</body>
</html>
